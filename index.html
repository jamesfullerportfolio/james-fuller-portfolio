<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Robopera</title>
  <meta name="description" content="A clean, lightweight portfolio to showcase images and videos." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="styles.css">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¨</text></svg>">

  <style>
    :root { --bg: #0b0b0c; --fg: #f5f7fa; }
    html { background: var(--bg); color: var(--fg); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    /* Carousel sizing */
    #carouselStage { min-height: 60vh; }
    .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); }
    .nav-btn[disabled] { opacity: 0.35; pointer-events: none; }
  </style>
</head>
<body class="bg-[var(--bg)] text-[var(--fg)] selection:bg-white/20">
  <header class="max-w-6xl mx-auto px-4 sm:px-6 py-8">
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-6">
      <div>
        <h1 class="text-3xl sm:text-4xl font-bold tracking-tight">James Fuller</h1>
        <p class="text-sm sm:text-base text-white/70 mt-2">
          Location Â· Mediums Â· Contact:
          <a class="underline hover:opacity-80" href="mailto:jamesfullerportfolio@gmail.com">jamesfullerportfolio@gmail.com</a>
        </p>
      </div>
      <nav class="flex gap-2 flex-wrap">
        <button data-filter="all" class="filter-btn px-3 py-1.5 rounded-2xl bg-white/10 hover:bg-white/20 text-sm">All</button>
        <button data-filter="image" class="filter-btn px-3 py-1.5 rounded-2xl bg-white/10 hover:bg-white/20 text-sm">Images</button>
        <button data-filter="video" class="filter-btn px-3 py-1.5 rounded-2xl bg-white/10 hover:bg-white/20 text-sm">Videos</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 pb-20">
    <!-- Carousel -->
    <section class="relative">
      <div id="carouselStage" class="relative rounded-2xl overflow-hidden shadow-2xl shadow-black/30 bg-white/5 border border-white/10">
        <!-- Prev / Next -->
        <button id="prevBtn" class="nav-btn left-0 px-3 py-2 rounded-r-xl bg-white/10 hover:bg-white/20">â€¹</button>
        <button id="nextBtn" class="nav-btn right-0 px-3 py-2 rounded-l-xl bg-white/10 hover:bg-white/20">â€º</button>

        <!-- Slide container -->
        <div id="slideHost" class="w-full h-full">
          <!-- injected slide goes here -->
        </div>

        <!-- Top bar (title + actions) -->
        <div class="absolute left-0 right-0 top-0 flex items-center justify-between px-3 py-2 text-sm">
          <div id="slideMeta" class="text-white/70"></div>
          <div id="slideActions" class="text-white/80"></div>
        </div>
      </div>

      <!-- Dots -->
      <div id="dots" class="flex flex-wrap gap-1.5 justify-center mt-4"></div>
    </section>
  </main>

  <footer class="max-w-6xl mx-auto px-4 sm:px-6 pb-10 text-xs text-white/50">
    <p>Â© <span id="year"></span> Robopera. All rights reserved.</p>
  </footer>

  <!-- SCRIPT -->
  <script>
    // ---- Config ----
    const PAYWALL = true;       // later, set true to remove free download buttons
    const LOOP   = false;        // set true to wrap at ends
    const SHOW_DOTS = false;      // set false to hide dots if you have tons of items

    // ---- Helpers ----
    const driveUrlSized = (id, w) => `https://lh3.googleusercontent.com/d/${id}=w${w}`;
    const driveDownloadUrl = (id) => `https://drive.google.com/uc?export=download&id=${id}`;

    // DOM
    const slideHost = document.getElementById('slideHost');
    const prevBtn   = document.getElementById('prevBtn');
    const nextBtn   = document.getElementById('nextBtn');
    const metaEl    = document.getElementById('slideMeta');
    const actionsEl = document.getElementById('slideActions');
    const dotsEl    = document.getElementById('dots');

    // State
    let master = [];    // all items from JSON
    let current = [];   // filtered list
    let idx = 0;        // current slide index
    let touchStartX = null;

    // Loader (JSON only, since you said you'll stick with it)
    async function loadJSON(path) {
      const res = await fetch(path, { cache: 'no-store' });
      if (!res.ok) throw new Error('artworks.json not found');
      const data = await res.json();
      const images = Array.isArray(data) ? data : (data.images || []);
      const videos = Array.isArray(data) ? [] : (data.videos || []);
      const prettify = (s='') => s.replace(/\.[^.]+$/, '').replace(/[_-]+/g, ' ').trim();

      const items = images.map(it => ({
        type: 'image',
        driveId: it.driveId || it.id,
        title: it.title || prettify(it.name || ''),
        alt: it.alt || it.title || '',
        purchaseUrl: it.purchaseUrl || null
      }));
      videos.forEach(v => {
        if (v.youtubeId || v.id) items.push({ type: 'youtube', id: v.youtubeId || v.id, title: v.title || '' });
      });
      return items;
    }

    // Build a single slide only (keeps memory/network tiny)
    function slideHTML(item) {
      if (!item) return '';
      if (item.type === 'image') {
        const id = item.driveId;
        const large = driveUrlSized(id, 2000);
        const srcset = [
          `${driveUrlSized(id, 1000)} 1000w`,
          `${driveUrlSized(id, 1500)} 1500w`,
          `${driveUrlSized(id, 2000)} 2000w`
        ].join(', ');
        const sizes = '(max-width: 1024px) 100vw, 1000px';

        // Actions
        const buyBtn = item.purchaseUrl ? `<a href="${item.purchaseUrl}" class="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 ml-2" target="_blank" rel="noopener">Buy HD Download</a>` : '';
        const dlBtn  = (!PAYWALL && !item.purchaseUrl) ? `<a href="${driveDownloadUrl(id)}" class="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 ml-2" target="_blank" rel="noopener">Download full-res</a>` : '';
        const openBtn = `<a href="${large}" class="px-2 py-1 rounded-lg bg-white/10 hover:bg-white/20 ml-2" target="_blank" rel="noopener">Open in new tab</a>`;
        actionsEl.innerHTML = openBtn + buyBtn + dlBtn;

        return `
          <div class="w-full h-full grid place-items-center p-4">
            <img src="${large}" srcset="${srcset}" sizes="${sizes}" alt="${item.alt || item.title || 'Artwork'}" class="max-h-[80vh] w-auto h-auto rounded-xl shadow-2xl" loading="eager" />
          </div>
        `;
      }

      if (item.type === 'youtube') {
        actionsEl.innerHTML = '';
        return `
          <div class="w-full h-full p-4">
            <div class="relative w-full" style="padding-top: 56.25%">
              <iframe class="absolute inset-0 w-full h-full rounded-xl"
                src="https://www.youtube.com/embed/${item.id}?autoplay=1"
                title="${item.title||''}"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </div>
          </div>
        `;
      }

      if (item.type === 'video') {
        actionsEl.innerHTML = '';
        return `
          <div class="w-full h-full grid place-items-center p-4">
            <video src="${item.src}" class="max-h-[80vh] w-auto h-auto rounded-xl shadow-2xl" controls autoplay playsinline></video>
          </div>
        `;
      }

      return '';
    }

    function updateMeta() {
      metaEl.textContent = `${idx + 1} / ${current.length}` + (current[idx]?.title ? ` â€” ${current[idx].title}` : '');
    }

    function syncButtons() {
      if (LOOP) { prevBtn.disabled = nextBtn.disabled = false; return; }
      prevBtn.disabled = (idx <= 0);
      nextBtn.disabled = (idx >= current.length - 1);
    }

    function renderDots() {
      if (!SHOW_DOTS) { dotsEl.innerHTML = ''; return; }
      const total = Math.min(current.length, 100); // cap dots visually if tons of items
      // If >100, show sparse dots (every Nth) to avoid 500 dots
      const step = current.length > 100 ? Math.ceil(current.length / 100) : 1;
      let html = '';
      for (let i = 0; i < current.length; i += step) {
        const active = Math.floor(idx/step) === Math.floor(i/step);
        html += `<button data-dot="${i}" class="w-2.5 h-2.5 rounded-full ${active ? 'bg-white' : 'bg-white/30'}"></button>`;
      }
      dotsEl.innerHTML = html;
    }

    function goTo(newIdx) {
      // bounds / loop
      if (LOOP) {
        idx = (newIdx + current.length) % current.length;
      } else {
        idx = Math.max(0, Math.min(current.length - 1, newIdx));
      }
      // swap single slide
      slideHost.innerHTML = slideHTML(current[idx]);
      updateMeta();
      syncButtons();
      renderDots();
      prefetchNeighbors();
    }

    function prefetchNeighbors() {
      const left = current[idx - 1];
      const right = current[idx + 1];
      [left, right].forEach(it => {
        if (it && it.type === 'image') {
          const im = new Image();
          im.src = driveUrlSized(it.driveId, 1500); // warm cache
        }
      });
    }

    function applyFilter(filter) {
      const match = (t) => filter === 'all' ? true : (filter === 'video' ? (t === 'video' || t === 'youtube') : t === filter);
      current = master.filter(x => match(x.type));
      if (!current.length) {
        slideHost.innerHTML = '<div class="p-8 text-center text-white/60">No items in this view.</div>';
        metaEl.textContent = '';
        actionsEl.innerHTML = '';
        dotsEl.innerHTML = '';
        prevBtn.disabled = nextBtn.disabled = true;
        return;
      }
      idx = 0;
      goTo(0);
    }

    // Events
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => applyFilter(btn.dataset.filter));
    });
    prevBtn.addEventListener('click', () => goTo(idx - 1));
    nextBtn.addEventListener('click', () => goTo(idx + 1));

    // Dots jump
    dotsEl.addEventListener('click', (e) => {
      const b = e.target.closest('[data-dot]');
      if (!b) return;
      const jump = parseInt(b.getAttribute('data-dot'), 10);
      if (Number.isFinite(jump)) goTo(jump);
    });

    // Keys + swipe
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft')  goTo(idx - 1);
      if (e.key === 'ArrowRight') goTo(idx + 1);
    });
    slideHost.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].clientX; }, {passive:true});
    slideHost.addEventListener('touchend', (e) => {
      if (touchStartX == null) return;
      const dx = e.changedTouches[0].clientX - touchStartX;
      if (Math.abs(dx) > 40) (dx > 0 ? goTo(idx - 1) : goTo(idx + 1));
      touchStartX = null;
    }, {passive:true});

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Start
    (async () => {
      try {
        master = await loadJSON('data/artworks.json');
        applyFilter('all');  // default view
      } catch (err) {
        console.error(err);
        slideHost.innerHTML = '<div class="p-8 text-center text-white/60">Could not load data/artworks.json</div>';
      }
    })();
  </script>
</body>
</html>
